# ุฑุงูููุง ูพฺฉุฑุจูุฏ Metis AI ุจุฑุง Onyx

## ูุนุฑู

Metis AI ฺฉ ุณุฑูุณ ุงุฑุงู ุงุณุช ฺฉู ุฏุณุชุฑุณ ุจู API ูุง OpenAI ู ุณุงุฑ ูุฏูโูุง ููุด ูุตููุน ุฑุง **ุจุฏูู ูุงุฒ ุจู ููุชุฑุดฺฉู** ู ุจุง **ูพุฑุฏุงุฎุช ุฑุงู** ูุฑุงูู ูโฺฉูุฏ.

### ูุฒุงุง
โ **ุจุฏูู ููุชุฑุดฺฉู**: ุฏุณุชุฑุณ ูุณุชูู ุงุฒ ุงุฑุงู
โ **ูพุฑุฏุงุฎุช ุฑุงู**: ูุงุฒ ุจู ุงุฑุฒ ุฎุงุฑุฌ ูุณุช
โ **ุณุฑุนุช ุจุงูุง**: ุณุฑูุฑูุง ูุฒุฏฺฉ ุจู ุงุฑุงู
โ **ุณุงุฒฺฏุงุฑ ุจุง OpenAI**: ููุงู API ู ฺฉุชุงุจุฎุงููโูุง
โ **ุฏุณุชุฑุณ ุจู ูุฏูโูุง ุฌุฏุฏ**: GPT-4o, GPT-4o-mini ู ...

---

## ูุฑุงุญู ุฑุงูโุงูุฏุงุฒ

### ูุฑุญูู 1: ุฏุฑุงูุช API Key

1. ุจู ูุจุณุงุช Metis AI ุจุฑูุฏ: **https://metisai.ir**
2. ุซุจุชโูุงู ฺฉูุฏ ู ูุงุฑุฏ ูพูู ฺฉุงุฑุจุฑ ุดูุฏ
3. ุงุฒ ุจุฎุด API Keys ฺฉ ฺฉูุฏ ุฌุฏุฏ ุจุณุงุฒุฏ
4. ฺฉูุฏ API ุดูุง ฺุฒ ุดุจู ุงู ุงุณุช: `tpsg-xxxxxxxxxxxxxxx`

**ฺฉูุฏ ุขูุงุฏู ุดุฏู ุฏุฑ ุงู ูพุฑูฺู**:
```
tpsg-ATDlOuvhdFEWjHUb4vHf56bU66LwoGi
```

---

### ูุฑุญูู 2: ุงุฌุฑุง ูพุฑูฺู

```bash
cd deployment/docker_compose

# ุงุฌุฑุง docker compose
docker compose up -d

# ูุดุงูุฏู ูุงฺฏโูุง
docker compose logs -f api_server
```

ููุชุธุฑ ุจูุงูุฏ ุชุง ุชูุงู ุณุฑูุณโูุง ุฑุงูโุงูุฏุงุฒ ุดููุฏ (ุญุฏูุฏ 2-3 ุฏููู).

---

### ูุฑุญูู 3: ุชูุธู Embedding Provider (ุจุฑุง ุฌุณุชุฌู)

ูุงู `.env` ุงุฒ ูพุด ูพฺฉุฑุจูุฏ ุดุฏู ุงุณุช:

```bash
# ุฏุฑ ูุงู .env
OPENAI_API_KEY=tpsg-ATDlOuvhdFEWjHUb4vHf56bU66LwoGi
OPENAI_API_BASE=https://api.metisai.ir/openai/v1
DOCUMENT_ENCODER_MODEL=openai/text-embedding-3-small
```

**ูฺฉุชู**: ุงฺฏุฑ ูโุฎูุงูุฏ ฺฉูุฏ ุฎูุฏุชุงู ุฑุง ุงุณุชูุงุฏู ฺฉูุฏุ ฺฉูุฏ ุจุงูุง ุฑุง ุจุง ฺฉูุฏ ุฎูุฏุชุงู ุฌุงฺฏุฒู ฺฉูุฏ.

---

### ูุฑุญูู 4: ุชูุธู LLM Provider (ุจุฑุง ฺุช)

#### ุฑูุด 1: ุงุฒ ุทุฑู UI (ุชูุตู ูโุดูุฏ)

1. **ูุงุฑุฏ ุจุฑูุงูู ุดูุฏ**:
   - ุขุฏุฑุณ: http://localhost:3000
   - ุงฺฏุฑ Authentication ูุนุงู ุงุณุชุ ูุงุฑุฏ ุดูุฏ
   - ุงฺฏุฑ Authentication ุบุฑูุนุงู ุงุณุช (ูพุดโูุฑุถ)ุ ูุณุชููุงู ูุงุฑุฏ ูโุดูุฏ

2. **ูุงุฑุฏ ุชูุธูุงุช Admin ุดูุฏ**:
   - ุฑู ุขฺฉูู ุชูุธูุงุช (โ๏ธ) ุฏุฑ sidebar ฺฉูฺฉ ฺฉูุฏ
   - ุง ุจู ุขุฏุฑุณ `http://localhost:3000/admin/configuration` ุจุฑูุฏ

3. **ุงุถุงูู ฺฉุฑุฏู LLM Provider**:
   - ุจู ุชุจ **"LLM Providers"** ุจุฑูุฏ
   - ุฏฺฉูู **"+ Add Provider"** ุฑุง ุจุฒูุฏ
   - ุงุทูุงุนุงุช ุฒุฑ ุฑุง ูุงุฑุฏ ฺฉูุฏ:

   ```
   Provider Name: Metis AI
   Provider Type: OpenAI
   API Key: tpsg-ATDlOuvhdFEWjHUb4vHf56bU66LwoGi
   API Base URL: https://api.metisai.ir/openai/v1
   Default Model: gpt-4o
   Fast Model: gpt-4o-mini
   ```

4. **ุฐุฎุฑู ู ูุนุงูโุณุงุฒ**:
   - ุฏฺฉูู **"Save"** ุฑุง ุจุฒูุฏ
   - provider ุฌุฏุฏ ุฑุง ุจู ุนููุงู **Default** ุงูุชุฎุงุจ ฺฉูุฏ

#### ุฑูุด 2: ุงุฒ ุทุฑู Database (ูพุดุฑูุชู)

```sql
-- ุงุชุตุงู ุจู database
docker compose exec relational_db psql -U postgres -d postgres

-- ุงุถุงูู ฺฉุฑุฏู LLM Provider
INSERT INTO llm_provider (name, provider, api_key, api_base, default_model_name, fast_default_model_name, is_public, is_default_provider)
VALUES (
  'Metis AI',
  'openai',
  'tpsg-ATDlOuvhdFEWjHUb4vHf56bU66LwoGi',
  'https://api.metisai.ir/openai/v1',
  'gpt-4o',
  'gpt-4o-mini',
  true,
  true
);
```

---

### ูุฑุญูู 5: ุชุณุช ฺฉุฑุฏู

#### ุชุณุช Embedding (ุฌุณุชุฌู):

1. ุฏุฑ UI ฺฉ Connector ุงุถุงูู ฺฉูุฏ (ูุซูุงู Web Connector)
2. ฺฉ ุณูุฏ ุฑุง index ฺฉูุฏ
3. ุฏุฑ ูุณูุช Chat ฺฉ ุณูุงู ุจูพุฑุณุฏ
4. ุงฺฏุฑ ูุชุงุฌ ุฌุณุชุฌู ููุงุด ุฏุงุฏู ุดุฏุ Embedding ุฏุฑุณุช ฺฉุงุฑ ูโฺฉูุฏ โ

#### ุชุณุช LLM (ฺุช):

1. ุฏุฑ ูุณูุช Chat ฺฉ ุณูุงู ุณุงุฏู ุจูพุฑุณุฏ: "ุณูุงูุ ฺุทูุฑุ"
2. ุงฺฏุฑ ูพุงุณุฎ ุฏุฑุงูุช ฺฉุฑุฏุฏุ LLM ุฏุฑุณุช ฺฉุงุฑ ูโฺฉูุฏ โ

#### ุชุณุช ุงุฒ ุทุฑู Logs:

```bash
# ุจุฑุฑุณ ูุงฺฏโูุง embedding
docker compose logs api_server | grep -i "embedding"

# ุจุฑุฑุณ ูุงฺฏโูุง LLM
docker compose logs api_server | grep -i "litellm"
```

---

## ูุฏูโูุง ููุฌูุฏ ุฏุฑ Metis AI

### ูุฏูโูุง Chat (LLM):
- `gpt-4o` - ุฌุฏุฏุชุฑู ู ูุฏุฑุชููุฏุชุฑู ูุฏู OpenAI
- `gpt-4o-mini` - ุณุฑุนโุชุฑ ู ุงุฑุฒุงูโุชุฑ ุจุฑุง ฺฉุงุฑูุง ุณุงุฏู
- `gpt-4-turbo` - ูุฏู ูุจูุ ููฺูุงู ูุฏุฑุชููุฏ
- `gpt-3.5-turbo` - ุงุฑุฒุงู ู ุณุฑุน

### ูุฏูโูุง Embedding:
- `text-embedding-3-small` - 1536 ุจุนุฏ (ูพุดโูุฑุถุ ุชูุตู ูโุดูุฏ)
- `text-embedding-3-large` - 3072 ุจุนุฏ (ุฏููโุชุฑ ูู ฺฉูุฏุชุฑ)
- `text-embedding-ada-002` - ูุฏู ูุฏู (legacy)

### ูุฏูโูุง Vision:
- `gpt-4o` - ูพุดุชุจุงู ุงุฒ ุชุตูุฑ

### ูุฏูโูุง Audio:
- `gpt-4o-transcribe` - ุชุจุฏู ุตูุช ุจู ูุชู (Whisper)
- `gpt-4o-mini-tts` - ุชุจุฏู ูุชู ุจู ุตูุช

---

## ูพฺฉุฑุจูุฏโูุง ูพุดุฑูุชู

### ุชุบุฑ ูุฏู Embedding

ุงฺฏุฑ ูโุฎูุงูุฏ ุงุฒ ูุฏู ุฏููโุชุฑ ุงุณุชูุงุฏู ฺฉูุฏ:

```bash
# ุฏุฑ ูุงู .env
DOCUMENT_ENCODER_MODEL=openai/text-embedding-3-large
DOC_EMBEDDING_DIM=3072
```

**ูุดุฏุงุฑ**: ุงฺฏุฑ ุงู ุฑุง ุชุบุฑ ุฏูุฏุ ุจุงุฏ ุชูุงู ุงุณูุงุฏ ุฑุง ุฏูุจุงุฑู index ฺฉูุฏ.

### ุชูุธูุงุช Reranking

ุจุฑุง ุจูุจูุฏ ูุชุงุฌ ุฌุณุชุฌูุ ูโุชูุงูุฏ Reranking ุฑุง ูุนุงู ฺฉูุฏ:

1. ุงุฒ UI ุจู ุชูุธูุงุช Admin ุจุฑูุฏ
2. ุฏุฑ ุจุฎุด Search Settingsุ Reranking ุฑุง ูุนุงู ฺฉูุฏ
3. ุงฺฏุฑ ูโุฎูุงูุฏ ุงุฒ Cohere ุงุณุชูุงุฏู ฺฉูุฏ:
   ```bash
   DEFAULT_CROSS_ENCODER_PROVIDER_TYPE=cohere
   DEFAULT_CROSS_ENCODER_API_KEY=tpsg-ATDlOuvhdFEWjHUb4vHf56bU66LwoGi
   ```

### ุงุณุชูุงุฏู ุงุฒ ูุฏูโูุง ุฏฺฏุฑ

Metis AI ุงุฒ ูุฏูโูุง ุดุฑฺฉุชโูุง ุฏฺฏุฑ ูุฒ ูพุดุชุจุงู ูโฺฉูุฏ:

#### Anthropic Claude:
```
API Base URL: https://api.metisai.ir/anthropic/v1
Model: claude-3-5-sonnet-20241022
```

#### Google Gemini:
```
API Base URL: https://api.metisai.ir/google/v1
Model: gemini-2.0-flash-exp
```

---

## ุนุจโุงุจ

### ุฎุทุง: "OpenAI API key is invalid"

**ุนูุช**: ฺฉูุฏ API ุงุดุชุจุงู ุงุณุช ุง ูููุถ ุดุฏู.

**ุฑุงูโุญู**:
1. ุจู ูพูู Metis AI ุจุฑูุฏ ู ฺฉ ฺฉูุฏ ุฌุฏุฏ ุจุณุงุฒุฏ
2. ฺฉูุฏ ุฑุง ุฏุฑ `.env` ุง UI ุขูพุฏุช ฺฉูุฏ
3. ุณุฑูุณโูุง ุฑุง restart ฺฉูุฏ: `docker compose restart`

### ุฎุทุง: "Connection timeout"

**ุนูุช**: ุฏุณุชุฑุณ ุจู `api.metisai.ir` ูุณุฏูุฏ ุงุณุช ุง ุงูุชุฑูุช ูุทุน ุงุณุช.

**ุฑุงูโุญู**:
1. ุงุชุตุงู ุงูุชุฑูุช ุฑุง ุจุฑุฑุณ ฺฉูุฏ
2. ุณุน ฺฉูุฏ ุจุง `curl` ุชุณุช ฺฉูุฏ:
   ```bash
   curl https://api.metisai.ir/openai/v1/models \
     -H "Authorization: Bearer tpsg-ATDlOuvhdFEWjHUb4vHf56bU66LwoGi"
   ```
3. ุงฺฏุฑ ุงุฒ ููุชุฑุดฺฉู ุงุณุชูุงุฏู ูโฺฉูุฏุ ุขู ุฑุง ุฎุงููุด ฺฉูุฏ

### ุฎุทุง: "Embedding dimension mismatch"

**ุนูุช**: ูุจูุงู ุจุง ูุฏู ุฏฺฏุฑ index ฺฉุฑุฏูโุงุฏ.

**ุฑุงูโุญู**:
1. ุชูุงู ุงุณูุงุฏ ุฑุง ุญุฐู ฺฉูุฏ
2. Index ุฑุง rebuild ฺฉูุฏ
3. ุง ุงุฒ ููุงู ูุฏู ูุจู ุงุณุชูุงุฏู ฺฉูุฏ

### ุฎุทุง: "Model not found"

**ุนูุช**: ูุงู ูุฏู ุงุดุชุจุงู ุงุณุช ุง Metis ุงุฒ ุขู ูุฏู ูพุดุชุจุงู ููโฺฉูุฏ.

**ุฑุงูโุญู**:
1. ูุณุช ูุฏูโูุง ููุฌูุฏ ุฑุง ุงุฒ Metis ุจฺฏุฑุฏ:
   ```bash
   curl https://api.metisai.ir/openai/v1/models \
     -H "Authorization: Bearer your-api-key"
   ```
2. ุงุฒ ฺฉ ูุฏู ูุนุชุจุฑ ุงุณุชูุงุฏู ฺฉูุฏ

### ูุงฺฏโูุง ุฎุทุง ูุดุงู ูโุฏููุฏ

```bash
# ูุดุงูุฏู ูุงฺฏโูุง ฺฉุงูู
docker compose logs -f api_server

# ูุดุงูุฏู ุฎุทุงูุง ููุท
docker compose logs api_server | grep -i error

# ูุดุงูุฏู ูุงฺฏโูุง embedding
docker compose logs api_server | grep -i "embedding\|metis"
```

---

## ูุญุฏูุฏุชโูุง ู ูฺฉุงุช

### ูุญุฏูุฏุชโูุง API:
- **Rate Limiting**: ูุฑ API Key ูุญุฏูุฏุช request per minute ุฏุงุฑุฏ
- **Token Limits**: ูุฑ ูุฏู ูุญุฏูุฏุช token ุฏุงุฑุฏ
- **Context Window**: ูุฏูโูุง ูุฎุชูู context window ูุชูุงูุช ุฏุงุฑูุฏ

### ูฺฉุงุช ุงููุช:
- โ๏ธ **ฺฉูุฏ API ุฑุง ุจู ุงุดุชุฑุงฺฉ ูฺฏุฐุงุฑุฏ**
- โ๏ธ **ฺฉูุฏ ุฑุง ุฏุฑ ูุงูโูุง ุนููู commit ูฺฉูุฏ**
- โ๏ธ **ุจุฑุง production ุงุฒ environment variable ุงุณุชูุงุฏู ฺฉูุฏ**

### ุจูููโุณุงุฒ ูุฒูู:
- ุจุฑุง ฺฉุงุฑูุง ุณุงุฏู ุงุฒ `gpt-4o-mini` ุงุณุชูุงุฏู ฺฉูุฏ
- ุจุฑุง embedding ุงุฒ `text-embedding-3-small` ุงุณุชูุงุฏู ฺฉูุฏ
- Cache ุฑุง ูุนุงู ฺฉูุฏ ุชุง request ูุง ุชฺฉุฑุงุฑ ูุดููุฏ

---

## ูพุดุชุจุงู

### ูุณุชูุฏุงุช Metis AI:
- ูุจุณุงุช: https://metisai.ir
- ุฏุงฺฉูููุช: https://docs.metisai.ir
- ูพุดุชุจุงู: ุงุฒ ุทุฑู ูพูู ฺฉุงุฑุจุฑ

### ูุณุชูุฏุงุช Onyx:
- GitHub: https://github.com/onyx-dot-app/onyx
- Docs: https://docs.onyx.app
- Discord: https://discord.gg/onyx

---

## ูุชุฌูโฺฏุฑ

ุจุง ุงุณุชูุงุฏู ุงุฒ Metis AI:
- โ ูุงุฒ ุจู GPU ูุฏุงุฑุฏ
- โ ูุงุฒ ุจู ููุชุฑุดฺฉู ูุฏุงุฑุฏ
- โ ุจุง ุฑุงู ูพุฑุฏุงุฎุช ูโฺฉูุฏ
- โ ุณุฑุนุช ุจุงูุง ุฏุงุฑุฏ (ุณุฑูุฑูุง ุงุฑุงู)
- โ ุฏุณุชุฑุณ ุจู ุฌุฏุฏุชุฑู ูุฏูโูุง

**ูพุฑูฺู ุขูุงุฏู ุงุณุชูุงุฏู ุงุณุช! ๐**

ุจุฑุง ุดุฑูุน ฺุชุ ุจู http://localhost:3000 ุจุฑูุฏ ู ุงุฒ ููุด ูุตููุน ุฎูุฏ ูุฐุช ุจุจุฑุฏ!
